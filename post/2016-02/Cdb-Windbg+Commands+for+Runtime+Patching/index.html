<!doctype html>
<html lang="en" class="gradient-background">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Cdb/Windbg Commands for Runtime Patching</title>
		<meta name="description" content="David Risney&#39;s blog on web, coding, and things">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="dave.deletethis.net">
		<link rel="alternate" href="/feed/feed.json" type="application/json" title="dave.deletethis.net">

		<meta name="generator" content="Eleventy v2.0.0">

		<link rel="icon" type="image/svg+xml" href="/img/semicolon.svg">
		<link rel="stylesheet" href="/css/index.css">

		<script>
window.addEventListener("pageswap", async (e) => {
	if (e.viewTransition) {
		if (navigation.activation.from.url === navigation.activation.entry.url) {
			e.viewTransition.types.add('reload');
		} else {
			e.viewTransition.types.add('forwards');
		}
	}
});

window.addEventListener("pagereveal", async (e) => {
	if (e.viewTransition) {
		if (navigation.activation.from.url === navigation.activation.entry.url) {
			e.viewTransition.types.add('reload');
		} else {
			e.viewTransition.types.add('forwards');
		}
	}
});
		</script>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">dave.deletethis.net <img src="/img/semicolon-dark.svg" class="logo"></a>
			<nav>
				<h2 class="visually-hidden">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/post/">Blog</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/feed/feed.xml"><img class="logo" src="/img/rss-dark.svg"> Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			<h1>Cdb/Windbg Commands for Runtime Patching</h1>

<ul class="post-metadata">
	<li><time datetime="2016-02-08">08 February 2016</time></li>
</ul>

<div xmlns="http://www.w3.org/1999/xhtml"><div><p>
    You can use conditional breakpoints and debugging commands in windbg and cdb that together can amount to effectively patching a binary at runtime. This can be useful if you have symbols but you
    can't easily rebuild the binary. Or if the patch is small and the binary requires a great deal of time to rebuild.
  </p><h2>
    Skipping code
  </h2><p>
    If you want to skip a chunk of code you can set a breakpoint at the start address of the code to skip and set the breakpoint's command to change the instruction pointer register to point to the
    address at the end of the code to skip and go. Voila you're skipping over that code now. For example:
  </p><pre><code>bp 0x6dd6879b "r @eip=0x6dd687c3 ; g"</code></pre><h2>
    Changing parameters
  </h2><p>
    You may want to modify parameters or variables and this is simple of course. In the following example a conditional breakpoint ANDs out a bit from dwFlags. Now when we run its as if no one is
    passing in that flag.
  </p><pre><code>bp wiwi!RelativeCrack "?? dwFlags &amp;= 0xFDFFFFFF;g"</code></pre><p>
    Slightly more difficult is to modify string values. If the new string length is the same size or smaller than the previous, you may be able to modify the string value in place. But if the string
    is longer or the string memory isn't writable, you'll need a new chunk of memory into which to write your new string. You can use .dvalloc to allocate some memory and ezu to write a string into
    the newly allocated memory. In the following example I then overwrite the register containing the parameter I want to modify:
  </p><pre><code>.dvalloc 100<br />ezu 000002a9`d4eb0000 "mfcore.dll"<br />r rcx = 000002a9`d4eb0000</code></pre><h2>
    Calling functions
  </h2><p>
    You can also use .call to actually make new calls to methods or functions. Read more about that on the Old New Thing: <a href="https://blogs.msdn.microsoft.com/oldnewthing/20070427-00/?p=27083/">Stupid debugger tricks: Calling functions and methods</a>. Again, all of this can be used in a breakpoint command to
    effectively patch a binary.
  </p></div></div>

<ul class="links-nextprev"><li>Previous: <a href="/post/2016-02/Let-s+Encrypt+NearlyFreeSpeech.net+Setup/">Let&#39;s Encrypt NearlyFreeSpeech.net Setup</a></li><li>Next: <a href="/post/2016-03/WinRT+Launcher+API+in+PowerShell/">WinRT Launcher API in PowerShell</a></li>
</ul>

		</main>

		<footer></footer>

		<!-- Current page: /post/2016-02/Cdb-Windbg+Commands+for+Runtime+Patching/ -->
	</body>
</html>
