<!doctype html>
<html lang="en" class="gradient-background">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Web Worker Initialization Race</title>
		<meta name="description" content="Dave Risney&#39;s blog on web, coding, and things">
		<link rel="alternate" href="/dave/feed/feed.xml" type="application/atom+xml" title="deletethis.net">
		<link rel="alternate" href="/dave/feed/feed.json" type="application/json" title="deletethis.net">

		<meta name="generator" content="Eleventy v2.0.0">

		<link rel="icon" type="image/svg+xml" href="/dave/img/semicolon.svg">
		<link rel="stylesheet" href="/dave/css/index.css">

		<script>
window.addEventListener("pageswap", async (e) => {
	if (e.viewTransition) {
		if (navigation.activation.from.url === navigation.activation.entry.url) {
			e.viewTransition.types.add('reload');
		} else {
			e.viewTransition.types.add('forwards');
		}
	}
});

window.addEventListener("pagereveal", async (e) => {
	if (e.viewTransition) {
		if (navigation.activation.from.url === navigation.activation.entry.url) {
			e.viewTransition.types.add('reload');
		} else {
			e.viewTransition.types.add('forwards');
		}
	}
});
		</script>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/dave/" class="home-link">deletethis.net<!-- img src="/img/semicolon-dark.svg" class="logo" --></a>
			<nav>
				<h2 class="visually-hidden">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/dave/post/">Blog</a></li>
					<li class="nav-item"><a href="/dave/about/">About</a></li>
					<li class="nav-item"><a href="/dave/feed/feed.xml"><!-- img class="logo" src="/img/rss-dark.svg" -->Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			<h1>Web Worker Initialization Race</h1>

<ul class="post-metadata">
	<li><time datetime="2012-02-24">24 February 2012</time></li>
</ul>

<div xmlns="http://www.w3.org/1999/xhtml"><div><p>
    Elaborating on a previous brief post on the topic of <a href="http://deletethis.net/dave/?uri=http%3A%2F%2Flists.whatwg.org%2Fpipermail%2Fhelp-whatwg.org%2F2010-August%2F000606.html">Web Worker
    initialization race conditions</a>, there's two important points to avoid a race condition when setting up a Worker:
  </p><ol><li>The parent starts the communication posting to the worker.
    </li><li>The worker sets up its message handler in its first synchronous block of execution.
    </li></ol><p>
    For example the following has no race becaues the spec guarentees that messages posted to a worker during its first synchronous block of execution will be queued and handled after that block. So
    the worker gets a chance to setup its onmessage handler. No race:
  </p><pre><code>'parent.js':<br>   var worker = new Worker();<br>   worker.postMessage("initialize");<br><br>'worker.js':<br>   onmessage = function(e) {<br>      // ...<br>   }</code></pre><p>
    The following has a race because there's no guarentee that the parent's onmessage handler is setup before the worker executes postMessage. Race (violates 1):
  </p><pre><code>'parent.js':<br>   var worker = new Worker();<br>   worker.onmessage = function(e) {<br>      // ...<br>   };<br><br>'worker.js':<br>   postMessage("initialize");<br></code></pre><p>
    The following has a race because the worker has no onmessage handler set in its first synchronous execution block and so the parent's postMessage may be sent before the worker sets its onmessage
    handler. Race (violates 2):
  </p><pre><code>'parent.js':<br>   var worker = new Worker();<br>   worker.postMessage("initialize");<br><br>'worker.js':<br>   setTimeout(<br>      function() {<br>         onmessage = function(e) {<br>            // ...<br>         }<br>      },<br>      0);<br></code></pre></div></div>

<ul class="links-nextprev"><li>Previous: <a href="/dave/2012-02/Prime+HTTP+Status+Codes/">Prime HTTP Status Codes</a></li><li>Next: <a href="/dave/2012-02/Client+Side+Cross+Domain+Data+YQL+Hack/">Client Side Cross Domain Data YQL Hack</a></li>
</ul>

		</main>

		<footer></footer>

		<!-- Current page: /dave/2012-02/Web+Worker+Initialization+Race/ -->
	</body>
</html>
