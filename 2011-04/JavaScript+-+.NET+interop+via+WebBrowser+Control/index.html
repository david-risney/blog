<!doctype html>
<html lang="en" class="gradient-background">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>JavaScript &amp; .NET interop via WebBrowser Control</title>
		<meta name="description" content="Dave Risney&#39;s blog on web, coding, and things">
		<link rel="alternate" href="/dave/feed/feed.xml" type="application/atom+xml" title="deletethis.net">
		<link rel="alternate" href="/dave/feed/feed.json" type="application/json" title="deletethis.net">

		<meta name="generator" content="Eleventy v2.0.0">

		<link rel="icon" type="image/svg+xml" href="/dave/img/semicolon.svg">
		<link rel="stylesheet" href="/dave/css/index.css">

		<script>
window.addEventListener("pageswap", async (e) => {
	if (e.viewTransition) {
		if (navigation.activation.from.url === navigation.activation.entry.url) {
			e.viewTransition.types.add('reload');
		} else {
			e.viewTransition.types.add('forwards');
		}
	}
});

window.addEventListener("pagereveal", async (e) => {
	if (e.viewTransition) {
		if (navigation.activation.from.url === navigation.activation.entry.url) {
			e.viewTransition.types.add('reload');
		} else {
			e.viewTransition.types.add('forwards');
		}
	}
});
		</script>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/dave/" class="home-link">deletethis.net<!-- img src="/img/semicolon-dark.svg" class="logo" --></a>
			<nav>
				<h2 class="visually-hidden">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/dave/post/">Blog</a></li>
					<li class="nav-item"><a href="/dave/about/">About</a></li>
					<li class="nav-item"><a href="/dave/feed/feed.xml"><!-- img class="logo" src="/img/rss-dark.svg" -->Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			<h1>JavaScript &amp; .NET interop via WebBrowser Control</h1>

<ul class="post-metadata">
	<li><time datetime="2011-04-05">05 April 2011</time></li>
</ul>

<div xmlns="http://www.w3.org/1999/xhtml"><div><p>
    For my <a href="http://deletethis.net/dave/dev/geolocmock/">GeolocMock</a> weekend project I intended to use the Bing Maps API to display a map in a WebBrowser control and allow the user to
    interact with that to select a location to be consumed by my application. Getting my .NET code to talk to the JavaScript in the WebBrowser control was surprisingly easy.
  </p><p>
    To have .NET execute JavaScript code you can use the InvokeScript method passing the name of the JavaScript function to execute and an object array of parameters to pass:
  </p><pre><code>this.webBrowser2.Document.InvokeScript("onLocationStateChanged",<br>   new object[] {<br>      latitudeTextBoxText,<br>      longitudeTextBoxText,<br>      altitudeTextBoxText,<br>      uncertaintyTextBoxText<br>   });</code></pre><p>
    The other direction, having JavaScript call into .NET is slightly more complicated but still pretty easy as far as language interop goes. The first step is to mark your assembly as ComVisible so
    that it can interact with JavaScript via COM. VS had already added a ComVisible declaration to my project I just had to change the value to true.
  </p><pre><code>[assembly: ComVisible(true)]</code></pre><p>
    Next set ObjectForScripting attribute to the object you want to expose to JavaScript.
  </p><pre><code>this.webBrowser2.ObjectForScripting = this.locationState;</code></pre><p>
    Now that object is exposed as window.external in JavaScript and you can call methods on it.
  </p><pre><code>window.external.Set(lat, long, alt, gUncert);</code></pre><p>
    However you don't seem to be able to test for the existence of methods off of it. For example the following JavaScript generates an exception for me even though I have a Set method:
  </p><pre><code>if (window.external &amp;&amp; window.external.Set) {</code></pre><div class="blogger-post-footer"><img width="1" height="1" src="https://blogger.googleusercontent.com/tracker/1670048653123050463-1115399204951118616?l=davescoolblog.blogspot.com" alt=""></div></div></div>

<ul class="links-nextprev"><li>Previous: <a href="/dave/2011-04/IE9+Document+Mode+in+WebOC/">IE9 Document Mode in WebOC</a></li><li>Next: <a href="/dave/2011-04/Capturing+HTTPS+with+FiddlerCore/">Capturing HTTPS with FiddlerCore</a></li>
</ul>

		</main>

		<footer></footer>

		<!-- Current page: /dave/2011-04/JavaScript+-+.NET+interop+via+WebBrowser+Control/ -->
	</body>
</html>
